var um_members_directory_busy=[],um_member_directories=[],um_member_directory_last_data=[];function um_parse_current_url(){var e={},r=window.location.search.substring(1).split("&");return jQuery.each(r,function(t){var a=r[t].split("=");e[a[0]]=a[1]}),e}function um_get_data_for_directory(e,r){var t=um_members_get_hash(e),a={},i=um_parse_current_url();if(jQuery.each(i,function(e){-1!==e.indexOf("_"+t)&&""!==i[e]&&(a[e.replace("_"+t,"")]=i[e])}),!r)return a;if(void 0!==a[r])try{a[r]=decodeURIComponent(a[r])}catch(m){console.error(m)}return a[r]}function um_set_url_from_data(e,r,t){var a=um_members_get_hash(e),i=um_get_data_for_directory(e),m={};Array.isArray(t)?(jQuery.each(t,function(e){t[e]=encodeURIComponent(t[e])}),t=t.join("||")):jQuery.isNumeric(t)||(t=t.split("||"),jQuery.each(t,function(e){t[e]=encodeURIComponent(t[e])}),t=t.join("||")),""!==t&&(m[r+"_"+a]=t),jQuery.each(i,function(e){r===e?""!==t&&(m[e+"_"+a]=t):m[e+"_"+a]=i[e]}),jQuery.each(um_member_directories,function(e){var r=um_member_directories[e];if(r!==a){var t=jQuery('.um-directory[data-hash="'+r+'"]'),i=um_get_data_for_directory(t);jQuery.each(i,function(e){m[e+"_"+r]=i[e]})}});var d=[];jQuery.each(m,function(e){d.push(e+"="+m[e])});var s="?"+(d=wp.hooks.applyFilters("um_member_directory_url_attrs",d)).join("&");"?"===s&&(s=""),window.history.pushState("string","UM Member Directory",window.location.origin+window.location.pathname+s)}function um_members_get_hash(e){return e.data("hash")}function um_is_directory_busy(e){var r=um_members_get_hash(e);return void 0!==um_members_directory_busy[r]&&um_members_directory_busy[r]}function um_members_show_preloader(e){um_members_directory_busy[um_members_get_hash(e)]=!0,e.find(".um-members-overlay").show()}function um_members_hide_preloader(e){um_members_directory_busy[um_members_get_hash(e)]=!1,e.find(".um-members-overlay").hide()}function um_set_range_label(e,r){var t,a,i="",m=e.siblings(".um-slider-range").data("placeholder-s"),d=e.siblings(".um-slider-range").data("placeholder-p");r?(i=r.values[0]===r.values[1]?m.replace("{value}",r.values[0]).replace("{field_label}",e.siblings(".um-slider-range").data("label")):d.replace("{min_range}",r.values[0]).replace("{max_range}",r.values[1]).replace("{field_label}",e.siblings(".um-slider-range").data("label")),t=r.values[0],a=r.values[1]):(i=e.slider("values",0)===e.slider("values",1)?m.replace("{value}",e.slider("values",0)).replace("{field_label}",e.siblings(".um-slider-range").data("label")):d.replace("{min_range}",e.slider("values",0)).replace("{max_range}",e.slider("values",1)).replace("{field_label}",e.siblings(".um-slider-range").data("label")),t=e.slider("values",0),a=e.slider("values",1)),e.siblings(".um-slider-range").html(i),e.siblings(".um_range_min").val(t),e.siblings(".um_range_max").val(a)}function um_get_search(e){return e.find(".um-search-line").length?e.find(".um-search-line").val():""}function um_get_sort(e){return e.data("sorting")}function um_get_current_page(e){var r=e.data("page");return r&&void 0!==r||(r=1),r}function um_time_convert(e,r){var t=Math.floor(e/60),a=e%60;return a>=60&&(a=0,(t+=1)>=24&&(t=0)),a<10&&(a="0"+a),t+":"+a}function um_ajax_get_members(e,r){var t=um_members_get_hash(e);if(!wp.hooks.applyFilters("um_member_directory_get_members_allow",!0,t,e)){setTimeout(um_ajax_get_members,600,e,r);return}var a=um_get_current_page(e),i=um_get_search(e),m=um_get_sort(e),d=-new Date().getTimezoneOffset()/60,s={directory_id:t,page:a,search:i,sorting:m,gmt_offset:d,post_refferer:e.data("base-post"),nonce:um_scripts.nonce};e.find(".um-search-filter").length&&e.find(".um-search-filter").each(function(){var r=jQuery(this);if(r.find(".um-slider").length){var t=r.find(".um-slider").data("field_name"),a=um_get_data_for_directory(e,"filter_"+t+"_from"),i=um_get_data_for_directory(e,"filter_"+t+"_to");(void 0!==a||void 0!==i)&&(s[t]=[a,i])}else if(r.find(".um-datepicker-filter").length){var t=r.find(".um-datepicker-filter").data("filter_name"),a=um_get_data_for_directory(e,"filter_"+t+"_from"),i=um_get_data_for_directory(e,"filter_"+t+"_to");(void 0!==a||void 0!==i)&&(s[t]=[a,i])}else if(r.find(".um-timepicker-filter").length){var t=r.find(".um-timepicker-filter").data("filter_name"),a=um_get_data_for_directory(e,"filter_"+t+"_from"),i=um_get_data_for_directory(e,"filter_"+t+"_to");if(void 0!==a){var a=a.split(":"),m=1*a[0];m<10&&(m="0"+m);var d=1*a[1];d<10&&(d="0"+d),a=m+":"+d+":00"}if(void 0!==i){var o=i.split(":"),d=1*o[1],m=1*o[0];m<10&&(m="0"+m),d<10&&(d="0"+d),i=m+":"+d+":59"}(void 0!==a||void 0!==i)&&(s[t]=[a,i])}else if(r.find("select").length){var t=r.find("select").attr("name"),l=um_get_data_for_directory(e,"filter_"+t);void 0!==l&&(l=um_unsanitize_value(l),s[t]=l.split("||"))}else if(r.hasClass("um-text-filter-type")&&r.find('input[type="text"]').length){var t=r.find('input[type="text"]').attr("name"),l=um_get_data_for_directory(e,"filter_"+t);void 0!==l&&(l=um_unsanitize_value(l),s[t]=l)}else s=wp.hooks.applyFilters("um_member_directory_custom_filter_handler",s,r,e)}),s=wp.hooks.applyFilters("um_member_directory_filter_request",s),wp.ajax.send("um_get_members",{data:s,success:function(r){um_member_directory_last_data[t]=r,um_build_template(e,r);var a=wp.template("um-members-pagination");e.find(".um-members-pagination-box").html(a(r)),e.data("total_pages",r.pagination.total_pages),r.pagination.total_pages?(e.find(".um-member-directory-sorting-options").prop("disabled",!1),e.find(".um-member-directory-view-type").removeClass("um-disabled")):(e.find(".um-member-directory-sorting-options").prop("disabled",!0),e.find(".um-member-directory-view-type").addClass("um-disabled")),wp.hooks.doAction("um_member_directory_loaded",e,r),um_init_new_dropdown(),um_members_hide_preloader(e)},error:function(r){console.log(r),um_members_hide_preloader(e)}})}function um_build_template(e,r){var t=e.data("view_type"),a=wp.template("um-member-"+t+"-"+um_members_get_hash(e));if(jQuery(".um-"+um_members_get_hash(e)).length){e.find(".um-members-grid, .um-members-list").remove(),e.find(".um-members-wrapper").prepend(a(r.users));var i=wp.template("um-members-header");e.find(".um-members-intro").remove();var m=wp.hooks.applyFilters("um_member_directory_generate_header",!1,e);(void 0!==r.is_search&&r.is_search||m)&&e.find(".um-members-wrapper").prepend(i(r)),e.addClass("um-loaded"),wp.hooks.addAction("um_window_resize","um_members",function(){e.find(".um-members.um-members-grid").length&&UM_Member_Grid(e.find(".um-members.um-members-grid"))}),jQuery(document).trigger("um_build_template",[e,r]),jQuery(window).trigger("resize"),UM.common.tipsy.init()}}function UM_Member_Grid(e){e.find(".um-member").length&&e.imagesLoaded(function(){var r=wp.hooks.applyFilters("um_member_directory_grid_masonry_attrs",{itemSelector:".um-member",columnWidth:".um-member",gutter:".um-gutter-sizer"},e);e.masonry(r).on("layoutComplete",function(e,r){jQuery(document).trigger("um_grid_initialized",[e,r])})})}function um_get_filters_data(e){var r=[];return e.find(".um-search-filter").each(function(){var t=jQuery(this);if(t.find("input.um-datepicker-filter").length)d="datepicker",t.find("input.um-datepicker-filter").each(function(){if("to"!==jQuery(this).data("range")){var t,a=jQuery(this).data("filter_name"),i=um_get_data_for_directory(e,"filter_"+a+"_from"),m=um_get_data_for_directory(e,"filter_"+a+"_to");if(void 0!==i||void 0!==m){var s=jQuery(this).val(),o=e.find('input.um-datepicker-filter[data-range="to"][data-filter_name="'+a+'"]').val();s===o?t=o:""!==s&&""!==o?t=s+" - "+o:""===s?t="before "+o:""===o&&(t="since "+s),r.push({name:a,label:jQuery(this).data("filter-label"),value_label:t,value:[i,m],type:d})}}});else if(t.find("input.um-timepicker-filter").length)d="timepicker",t.find("input.um-timepicker-filter").each(function(){if("to"!==jQuery(this).data("range")){var t,a=jQuery(this).data("filter_name"),i=um_get_data_for_directory(e,"filter_"+a+"_from"),m=um_get_data_for_directory(e,"filter_"+a+"_to");if(void 0!==i||void 0!==m){var s=jQuery(this).val(),o=e.find('input.um-timepicker-filter[data-range="to"][data-filter_name="'+a+'"]').val();s===o?t=o:""!==s&&""!==o?t=s+" - "+o:""===s?t="before "+o:""===o&&(t="since "+s),r.push({name:a,label:jQuery(this).data("filter-label"),value_label:t,value:[i,m],type:d})}}});else if(t.find("select").length){d="select",i=t.find("select").attr("name"),m=t.find("select").data("placeholder");var a=um_get_data_for_directory(e,"filter_"+i);a=void 0===a?[]:(a=um_unsanitize_value(a)).split("||"),jQuery.each(a,function(e){var s=t.find('select option[value="'+a[e]+'"]').data("value_label");r.push({name:i,label:m,value_label:s,value:a[e],type:d})})}else if(t.hasClass("um-text-filter-type")&&t.find('input[type="text"]').length){d="text",i=t.find('input[type="text"]').attr("name"),m=t.find('input[type="text"]').attr("placeholder");var a=um_get_data_for_directory(e,"filter_"+i);void 0===a&&(a=""),""!=a&&r.push({name:i,label:m,value_label:a,value:a,type:d})}else if(t.find("div.ui-slider").length){d="slider";var i,m,d,s,o=um_get_data_for_directory(e,"filter_"+(i=t.find("div.ui-slider").data("field_name"))+"_from"),l=um_get_data_for_directory(e,"filter_"+i+"_to");if(void 0===o&&void 0===l)return;s=o===l?t.find("div.um-slider-range").data("placeholder-s").replace("{value}",o).replace("{field_label}",t.find("div.um-slider-range").data("label")):t.find("div.um-slider-range").data("placeholder-p").replace("{min_range}",o).replace("{max_range}",l).replace("{field_label}",t.find("div.um-slider-range").data("label")),m=t.find("div.um-slider-range").data("label"),r.push({name:i,label:m,value_label:s,value:[o,l],type:d})}else r=wp.hooks.applyFilters("um_member_directory_get_filter_data",r,e,t)}),r}function um_change_tag(e){var r=um_get_filters_data(e);e.find(".um-members-filter-tag").remove();var t=e.find(".um-filtered-line");if(t.length){var a=wp.template("um-members-filtered-line");t.prepend(a({filters:r})),0===e.find(".um-members-filter-remove").length?(e.find(".um-clear-filters").hide(),e.find(".um-clear-filters").parents(".um-member-directory-header-row").addClass("um-header-row-invisible")):(e.find(".um-clear-filters").show(),e.find(".um-clear-filters").parents(".um-member-directory-header-row").removeClass("um-header-row-invisible"))}}function um_run_search(e){if(!um_is_directory_busy(e)){um_members_show_preloader(e);var r=um_get_data_for_directory(e,"search"),t=um_sanitize_value(e.find(".um-search-line").val());if(t===r||""===t&&void 0===r){um_members_hide_preloader(e);return}e.data("general_search",t),um_set_url_from_data(e,"search",t),e.data("page",1),um_set_url_from_data(e,"page","");var a=!1;if(!(a=wp.hooks.applyFilters("um_member_directory_ignore_after_search",a,e))&&1===e.data("must-search")&&(t=um_get_search(e),0===e.find(".um-members-filter-remove").length&&!t)){e.data("searched",0),e.find(".um-members-grid, .um-members-list, .um-members-intro").remove(),e.find(".um-member-directory-sorting-options").prop("disabled",!0),e.find(".um-member-directory-view-type").addClass("um-disabled"),wp.hooks.doAction("um_member_directory_clear_not_searched",e),um_members_hide_preloader(e);return}e.data("searched",1),e.find(".um-member-directory-sorting-options").prop("disabled",!1),e.find(".um-member-directory-view-type").removeClass("um-disabled"),um_ajax_get_members(e)}}function um_slider_filter_init(e){e.find(".um-slider").each(function(){var e=jQuery(this),r=e.parents(".um-directory"),t=e.data("field_name"),a=um_get_data_for_directory(r,"filter_"+t+"_from"),i=um_get_data_for_directory(r,"filter_"+t+"_to");void 0===a&&(a=parseInt(e.data("min"))),void 0===i&&(i=parseInt(e.data("max")));var m=[a,i];e.slider({range:!0,min:parseInt(e.data("min")),max:parseInt(e.data("max")),values:m,create:function(e,r){},step:1,slide:function(e,r){um_set_range_label(jQuery(this),r)},stop:function(e,a){um_is_directory_busy(r)||(um_members_show_preloader(r),um_set_url_from_data(r,"filter_"+t+"_from",a.values[0]),um_set_url_from_data(r,"filter_"+t+"_to",a.values[1]),r.data("page",1),um_set_url_from_data(r,"page",""),um_ajax_get_members(r),um_change_tag(r),r.data("searched",1),r.find(".um-member-directory-sorting-options").prop("disabled",!1),r.find(".um-member-directory-view-type").removeClass("um-disabled"))}}),um_set_range_label(e)})}function um_datepicker_filter_init(e){e.find(".um-datepicker-filter").each(function(){var e=jQuery(this),r=new Date(1e3*e.data("date_min")),t=new Date(1e3*e.data("date_max")),a=e.pickadate({selectYears:!0,min:r,max:t,formatSubmit:"yyyy/mm/dd",hiddenName:!0,onOpen:function(){e.blur()},onClose:function(){e.blur()},onSet:function(a){if(a.select){var i=e.parents(".um-directory");if(!um_is_directory_busy(i)){um_members_show_preloader(i);var m=e.data("filter_name"),d=e.data("range"),s=um_get_data_for_directory(i,"filter_"+m+"_from"),o=um_get_data_for_directory(i,"filter_"+m+"_to");void 0===s&&(s=r/1e3),void 0===o&&(o=t/1e3);var l=a.select/1e3;e.val(),"from"===d?s=l:"to"===d&&(o=l),um_set_url_from_data(i,"filter_"+m+"_from",s),um_set_url_from_data(i,"filter_"+m+"_to",o),i.data("page",1),um_set_url_from_data(i,"page",""),um_ajax_get_members(i),um_change_tag(i),i.data("searched",1),i.find(".um-member-directory-sorting-options").prop("disabled",!1),i.find(".um-member-directory-view-type").removeClass("um-disabled")}}}}).pickadate("picker"),i=e.data("filter_name"),m=e.data("range"),d=um_get_data_for_directory(e.parents(".um-directory"),"filter_"+i+"_"+m);void 0!==d&&a.set("select",1e3*d)})}function um_timepicker_filter_init(e){e.find(".um-timepicker-filter").each(function(){var e=jQuery(this),r=e.attr("id"),t=e.data("filter_name"),a=e.attr("data-min"),i=e.attr("data-max"),m=a.split(":"),d=i.split(":"),s=e.pickatime({format:e.data("format"),interval:parseInt(e.data("intervals")),min:[m[0],m[1]],max:[d[0],d[1]],formatSubmit:"HH:i",hiddenName:!0,onOpen:function(){e.blur()},onClose:function(){e.blur()},onSet:function(m){if(m.select){var d=e.parents(".um-directory");if(!um_is_directory_busy(d)){um_members_show_preloader(d);var s=e.data("filter_name"),o=e.data("range"),l=um_get_data_for_directory(d,"filter_"+s+"_from"),u=um_get_data_for_directory(d,"filter_"+s+"_to");if(void 0===l&&(l=a),void 0===u&&(u=i),void 0!==m.select){var n=um_time_convert(m.select,o);"from"===o?l=n:"to"===o&&(u=n)}else"from"===o?l=a:"to"===o&&(u=i);var f=jQuery("#"+r).val();"from"===e.data("range")?jQuery("#"+t+"_to").pickatime("picker").set("min",f):jQuery("#"+t+"_from").pickatime("picker").set("max",f),um_set_url_from_data(d,"filter_"+s+"_from",l),um_set_url_from_data(d,"filter_"+s+"_to",u),d.data("page",1),um_set_url_from_data(d,"page",""),um_ajax_get_members(d),um_change_tag(d),d.data("searched",1),d.find(".um-member-directory-sorting-options").prop("disabled",!1),d.find(".um-member-directory-view-type").removeClass("um-disabled")}}}}).pickatime("picker"),o=e.data("filter_name"),l=e.data("range"),u=um_get_data_for_directory(e.parents(".um-directory"),"filter_"+o+"_"+l);if(void 0!==u){var n=u.split(":");s.set("select",60*n[0]+1*n[1])}})}jQuery(document.body).ready(function(){jQuery(".um-directory .um-search-filter select").each(function(){1===jQuery(this).find("option:not(:disabled)").length&&jQuery(this).prop("disabled",!0);var e=jQuery(this);e.select2("destroy").select2({dropdownParent:e.parent()})}),jQuery(document.body).on("mouseover",".um-directory .um-member-directory-view-type",function(){if(!jQuery(this).hasClass("um-disabled")){var e=jQuery(this).find(".um-member-directory-view-type-a:visible");e.hide(),e.next().length?e.next().show().tipsy("show"):jQuery(this).find(".um-member-directory-view-type-a:first").show().tipsy("show")}}).on("mouseout",".um-directory .um-member-directory-view-type",function(){!jQuery(this).hasClass("um-disabled")&&(jQuery(this).find(".um-member-directory-view-type-a").hide().tipsy("hide"),jQuery(this).find('.um-member-directory-view-type-a[data-type="'+jQuery(this).parents(".um-directory").data("view_type")+'"]').show())}),jQuery(document.body).on("click",".um-directory .um-member-directory-view-type-a",function(){var e=jQuery(this).parents(".um-directory");if(um_is_directory_busy(e))return!1;var r=jQuery(this),t=r.parents(".um-member-directory-view-type");if(!t.hasClass("um-disabled")){um_members_show_preloader(e);var a=t.find(".um-member-directory-view-type-a:visible");a.hide(),a.next().length?a.next().show().tipsy("show"):t.find(".um-member-directory-view-type-a:first").show().tipsy("show");var i=um_member_directory_last_data[um_members_get_hash(e)];if(null!==i){var m=r.data("type");um_set_url_from_data(e,"view_type",m),e.data("view_type",m),um_build_template(e,i),um_init_new_dropdown()}um_members_hide_preloader(e)}}),jQuery(document.body).on("click",".um-directory .um-do-search",function(){var e=jQuery(this).parents(".um-directory");um_run_search(e)}),jQuery(document.body).on("keypress",".um-directory .um-search-line",function(e){if(13===e.which){var r=jQuery(this).parents(".um-directory");um_run_search(r)}}),jQuery(document.body).on("click",'.um-new-dropdown[data-element=".um-member-directory-sorting-a"] li a',function(){if(1!==jQuery(this).data("selected")){var e=jQuery(this).data("directory-hash"),r=jQuery('.um-directory[data-hash="'+e+'"]');if(!um_is_directory_busy(r)){um_members_show_preloader(r);var t=jQuery(this).html(),a=jQuery(this).data("value");r.data("sorting",a),um_set_url_from_data(r,"sort",a),um_ajax_get_members(r),r.find('.um-new-dropdown[data-element=".um-member-directory-sorting-a"]').find("a").data("selected",0).prop("data-selected",0).attr("data-selected",0),r.find('.um-new-dropdown[data-element=".um-member-directory-sorting-a"] a[data-value="'+a+'"]').data("selected",1).prop("data-selected",1).attr("data-selected",1),r.find(".um-member-directory-sorting-a").find("> a").html(t)}}}),jQuery(document.body).on("click",".um-directory .pagi:not(.current)",function(){if(!jQuery(this).hasClass("disabled")){var e,r=jQuery(this).parents(".um-directory");!um_is_directory_busy(r)&&(um_members_show_preloader(r),1===(e="first"===jQuery(this).data("page")?1:"prev"===jQuery(this).data("page")?1*r.data("page")-1:"next"===jQuery(this).data("page")?1*r.data("page")+1:"last"===jQuery(this).data("page")?parseInt(r.data("total_pages")):parseInt(jQuery(this).data("page")))?(r.find('.pagi[data-page="first"], .pagi[data-page="prev"]').addClass("disabled"),r.find('.pagi[data-page="prev"], .pagi[data-page="last"]').removeClass("disabled")):e===parseInt(r.data("total_pages"))?(r.find('.pagi[data-page="prev"], .pagi[data-page="last"]').addClass("disabled"),r.find('.pagi[data-page="first"], .pagi[data-page="prev"]').removeClass("disabled")):(r.find('.pagi[data-page="prev"], .pagi[data-page="last"]').removeClass("disabled"),r.find('.pagi[data-page="first"], .pagi[data-page="prev"]').removeClass("disabled")),r.find(".pagi").removeClass("current"),r.find('.pagi[data-page="'+e+'"]').addClass("current"),r.data("page",e),1===e?um_set_url_from_data(r,"page",""):um_set_url_from_data(r,"page",e),um_ajax_get_members(r))}}),jQuery(document.body).on("change",".um-directory .um-members-pagi-dropdown",function(){var e=jQuery(this).parents(".um-directory");if(!um_is_directory_busy(e)){um_members_show_preloader(e);var r=jQuery(this).val();e.find(".pagi").removeClass("current"),e.find('.pagi[data-page="'+r+'"]').addClass("current"),e.data("page",r),1===r?um_set_url_from_data(e,"page",""):um_set_url_from_data(e,"page",r),um_ajax_get_members(e)}}),jQuery(document.body).on("click",".um-directory .um-members.um-members-list .um-member-more a",function(e){e.preventDefault();var r=jQuery(this).parents(".um-member");return r.find(".um-member-more").hide(),r.find(".um-member-meta-main").slideDown(),r.find(".um-member-less").fadeIn(),!1}),jQuery(document.body).on("click",".um-directory .um-members.um-members-list .um-member-less a",function(e){e.preventDefault();var r=jQuery(this).parents(".um-member");return r.find(".um-member-less").hide(),r.find(".um-member-meta-main").slideUp(),r.find(".um-member-more").fadeIn(),!1}),jQuery(document.body).on("click",".um-directory .um-members.um-members-grid .um-member-more a",function(e){e.preventDefault();var r=jQuery(this).parents(".um-member"),t=jQuery(this).parents(".um-members");return r.find(".um-member-more").hide(),r.find(".um-member-meta").slideDown(function(){UM_Member_Grid(t)}),r.find(".um-member-less").fadeIn(),setTimeout(function(){UM_Member_Grid(t)},100),!1}),jQuery(document.body).on("click",".um-directory .um-members.um-members-grid .um-member-less a",function(e){e.preventDefault();var r=jQuery(this).parents(".um-member"),t=jQuery(this).parents(".um-members");return r.find(".um-member-less").hide(),r.find(".um-member-meta").slideUp(function(){r.find(".um-member-more").fadeIn(),UM_Member_Grid(t)}),!1}),jQuery(".um-member-directory-filters-a").on("click",function(){var e=jQuery(this),r=e.parents(".um-directory").find(".um-search");r.is(":visible")?r.slideUp(250,function(){e.toggleClass("um-member-directory-filters-visible"),r.parents(".um-member-directory-header-row").toggleClass("um-header-row-invisible")}):r.slideDown({duration:250,start:function(){jQuery(this).css({display:"grid"}),e.toggleClass("um-member-directory-filters-visible"),r.parents(".um-member-directory-header-row").toggleClass("um-header-row-invisible")}})}),jQuery(document.body).on("change",".um-directory .um-search-filter select",function(){var e=jQuery(this).val(),r=um_sanitize_value(e);if(""!==r){var t=jQuery(this).parents(".um-directory");if(!um_is_directory_busy(t)){um_members_show_preloader(t);var a=jQuery(this).prop("name"),i=um_get_data_for_directory(t,"filter_"+a);i=void 0===i?[]:i.split("||"),-1===jQuery.inArray(r,i)&&(i.push(r),um_set_url_from_data(t,"filter_"+a,i=i.join("||")),t.data("page",1),um_set_url_from_data(t,"page","")),jQuery(this).find('option[value="'+e+'"]').prop("disabled",!0).hide(),1===jQuery(this).find("option:not(:disabled)").length&&jQuery(this).prop("disabled",!0);var m=jQuery(this);m.select2("destroy").select2({dropdownParent:m.parent()}),m.val("").trigger("change"),um_ajax_get_members(t),um_change_tag(t),t.data("searched",1),t.find(".um-member-directory-sorting-options").prop("disabled",!1),t.find(".um-member-directory-view-type").removeClass("um-disabled")}}}),jQuery(document.body).on("blur",'.um-directory .um-search-filter.um-text-filter-type input[type="text"]',function(){var e=jQuery(this).parents(".um-directory");if(!um_is_directory_busy(e)){var r=um_sanitize_value(jQuery(this).val()),t=jQuery(this).prop("name"),a=um_get_data_for_directory(e,"filter_"+t);void 0===a&&(a=""),r!==a&&(um_members_show_preloader(e),um_set_url_from_data(e,"filter_"+t,r),e.data("page",1),um_set_url_from_data(e,"page",""),um_ajax_get_members(e),um_change_tag(e),e.data("searched",1),e.find(".um-member-directory-sorting-options").prop("disabled",!1),e.find(".um-member-directory-view-type").removeClass("um-disabled"))}}),jQuery(document.body).on("keypress",'.um-directory .um-search-filter.um-text-filter-type input[type="text"]',function(e){if(13===e.which){var r=jQuery(this).parents(".um-directory");if(!um_is_directory_busy(r)){var t=um_sanitize_value(jQuery(this).val()),a=jQuery(this).prop("name"),i=um_get_data_for_directory(r,"filter_"+a);void 0===i&&(i=""),t!==i&&(um_members_show_preloader(r),um_set_url_from_data(r,"filter_"+a,t),r.data("page",1),um_set_url_from_data(r,"page",""),um_ajax_get_members(r),um_change_tag(r),r.data("searched",1),r.find(".um-member-directory-sorting-options").prop("disabled",!1),r.find(".um-member-directory-view-type").removeClass("um-disabled"))}}}),jQuery(document.body).on("click",".um-directory .um-members-filter-remove",function(){var e=jQuery(this).parents(".um-directory");if(!um_is_directory_busy(e)&&e){um_members_show_preloader(e);var r=jQuery(this).data("value"),t=jQuery(this).data("name"),a=jQuery(this).data("type");if("text"===a)um_set_url_from_data(e,"filter_"+t,""),jQuery('.um-search-filter input[name="'+t+'"]').val("");else if("select"===a){var i=um_get_data_for_directory(e,"filter_"+t);i=void 0===i?[]:(i=um_unsanitize_value(i)).split("||"),-1!==jQuery.inArray(r.toString(),i)&&(i=jQuery.grep(i,function(e){return e!==r.toString()})),i.length||(i=""),um_set_url_from_data(e,"filter_"+t,i);var m=jQuery('.um-search-filter select[name="'+t+'"]');m.find('option[value="'+r+'"]').prop("disabled",!1).show(),m.find("option:not(:disabled)").length>1&&m.prop("disabled",!1),m.select2("destroy").select2({dropdownParent:m.parent()}),e.find('.um-search-filter select[data-um-parent="'+t+'"]').length>0&&m.trigger("change")}else if("slider"===a){um_set_url_from_data(e,"filter_"+t+"_from",""),um_set_url_from_data(e,"filter_"+t+"_to","");var d=jQuery(".um-search-filter #"+t+"_min").siblings(".um-slider"),s=d.slider("option");d.slider("values",[s.min,s.max]),jQuery(".um-search-filter #"+t+"_min").val(""),jQuery(".um-search-filter #"+t+"_max").val(""),um_set_range_label(d)}else"datepicker"===a?(um_set_url_from_data(e,"filter_"+t+"_from",""),um_set_url_from_data(e,"filter_"+t+"_to",""),jQuery(".um-search-filter #"+t+"_from").val(""),jQuery(".um-search-filter #"+t+"_to").val("")):"timepicker"===a?(um_set_url_from_data(e,"filter_"+t+"_from",""),um_set_url_from_data(e,"filter_"+t+"_to",""),jQuery(".um-search-filter #"+t+"_from").val(""),jQuery(".um-search-filter #"+t+"_to").val("")):wp.hooks.doAction("um_member_directory_filter_remove",a,e,t,r);e.data("page",1),um_set_url_from_data(e,"page",""),jQuery(this).tipsy("hide"),jQuery(this).parents(".um-members-filter-tag").remove(),0===e.find(".um-members-filter-remove").length?e.find(".um-clear-filters").hide():e.find(".um-clear-filters").show();var o=!1;if(!(o=wp.hooks.applyFilters("um_member_directory_ignore_after_search",o,e))&&1===e.data("must-search")){var l=um_get_search(e);if(0===e.find(".um-members-filter-remove").length&&!l){e.data("searched",0),e.find(".um-members-grid, .um-members-list, .um-members-intro").remove(),e.find(".um-member-directory-sorting-options").prop("disabled",!0),e.find(".um-member-directory-view-type").addClass("um-disabled"),wp.hooks.doAction("um_member_directory_clear_not_searched",e),um_members_hide_preloader(e);return}}e.find(".um-member-directory-sorting-options").prop("disabled",!1),e.find(".um-member-directory-view-type").removeClass("um-disabled"),um_ajax_get_members(e)}}),jQuery(document.body).on("click",".um-directory .um-clear-filters-a",function(){var e=jQuery(this).parents(".um-directory");if(!um_is_directory_busy(e)){um_members_show_preloader(e),e.find(".um-members-filter-remove").each(function(){var r=jQuery(this).data("value"),t=jQuery(this).data("name"),a=jQuery(this).data("type");if("text"===a)um_set_url_from_data(e,"filter_"+t,""),jQuery('.um-search-filter input[name="'+t+'"]').val("");else if("select"===a){var i=um_get_data_for_directory(e,"filter_"+t);i=void 0===i?[]:(i=um_unsanitize_value(i)).split("||"),-1!==jQuery.inArray(r.toString(),i)&&(i=jQuery.grep(i,function(e){return e!==r.toString()})),i.length||(i=""),um_set_url_from_data(e,"filter_"+t,i);var m=jQuery('.um-search-filter select[name="'+t+'"]');m.find('option[value="'+r+'"]').prop("disabled",!1).show(),m.find("option:not(:disabled)").length>1&&m.prop("disabled",!1),m.select2("destroy").select2({dropdownParent:m.parent()}),e.find('.um-search-filter select[data-um-parent="'+t+'"]').length>0&&setTimeout(function(){m.trigger("change")},250)}else if("slider"===a){um_set_url_from_data(e,"filter_"+t+"_from",""),um_set_url_from_data(e,"filter_"+t+"_to","");var d=jQuery(".um-search-filter #"+t+"_min").siblings(".um-slider"),s=d.slider("option");d.slider("values",[s.min,s.max]),jQuery(".um-search-filter #"+t+"_min").val(""),jQuery(".um-search-filter #"+t+"_max").val(""),um_set_range_label(d)}else"datepicker"===a?(um_set_url_from_data(e,"filter_"+t+"_from",""),um_set_url_from_data(e,"filter_"+t+"_to",""),jQuery(".um-search-filter #"+t+"_from").val(""),jQuery(".um-search-filter #"+t+"_to").val("")):"timepicker"===a?(um_set_url_from_data(e,"filter_"+t+"_from",""),um_set_url_from_data(e,"filter_"+t+"_to",""),jQuery(".um-search-filter #"+t+"_from").val(""),jQuery(".um-search-filter #"+t+"_to").val("")):wp.hooks.doAction("um_member_directory_clear_filters",a,e,t,r)}),e.data("page",1),um_set_url_from_data(e,"page",""),e.find(".um-members-filter-tag").remove(),0===e.find(".um-members-filter-remove").length?(e.find(".um-clear-filters").hide(),e.find(".um-clear-filters").parents(".um-member-directory-header-row").addClass("um-header-row-invisible")):(e.find(".um-clear-filters").show(),e.find(".um-clear-filters").parents(".um-member-directory-header-row").removeClass("um-header-row-invisible"));var r=!1;if(!(r=wp.hooks.applyFilters("um_member_directory_ignore_after_search",r,e))&&1===e.data("must-search")&&!um_get_search(e)){e.data("searched",0),e.find(".um-members-grid, .um-members-list, .um-members-intro").remove(),e.find(".um-member-directory-sorting-options").prop("disabled",!0),e.find(".um-member-directory-view-type").addClass("um-disabled"),wp.hooks.doAction("um_member_directory_clear_not_searched",e),um_members_hide_preloader(e);return}e.find(".um-member-directory-sorting-options").prop("disabled",!1),e.find(".um-member-directory-view-type").removeClass("um-disabled"),um_ajax_get_members(e)}}),wp.hooks.doAction("um_member_directory_on_first_pages_loading"),jQuery(".um-directory").each(function(){var e=jQuery(this),r=um_members_get_hash(e);um_member_directories.push(r),e.find(".um-search").length&&!e.find(".um-search").is(":visible")&&e.find(".um-search").css({display:"grid"}).slideUp(1),um_slider_filter_init(e),um_datepicker_filter_init(e),um_timepicker_filter_init(e),wp.hooks.doAction("um_member_directory_on_init",e,r);var t=!1;if(!(t=wp.hooks.applyFilters("um_member_directory_ignore_after_search",t,e))&&1===e.data("must-search")){var a=um_get_search(e);if(!um_get_filters_data(e).length&&!a)return}wp.hooks.applyFilters("um_member_directory_prevent_default_first_loading",!1,e,r)||(um_members_show_preloader(e),um_ajax_get_members(e,{first_load:!0}),um_change_tag(e))}),window.addEventListener("popstate",function(e){jQuery(".um-directory").each(function(){var e=jQuery(this),r=um_members_get_hash(e);if(um_member_directories.push(r),um_members_show_preloader(e),e.find(".um-members-grid, .um-members-list, .um-members-intro").remove(),e.find(".um-member-directory-search-line").length){var t=um_get_data_for_directory(e,"search");void 0===t&&(t=""),e.data("general_search",t),e.find(".um-search-line").val(t)}var a=um_get_data_for_directory(e,"page");if(void 0===a?a=1:a>e.data("total_pages")&&(a=e.data("total_pages")),e.data("page",a).attr("data-page",a),e.find(".um-member-directory-sorting").length){var i=um_get_data_for_directory(e,"sort");void 0===i&&(i=e.find('.um-new-dropdown[data-element=".um-member-directory-sorting-a"]').find('a[data-default="1"]').data("value")),e.data("sorting",i);var m=e.find('.um-new-dropdown[data-element=".um-member-directory-sorting-a"]');m.find("a").data("selected",0).prop("data-selected",0).attr("data-selected",0),m.find('a[data-value="'+i+'"]').data("selected",1).prop("data-selected",1).attr("data-selected",1),e.find(".um-member-directory-sorting-a").find("> a").html(m.find('a[data-value="'+i+'"]').html())}if(e.find(".um-member-directory-view-type").length){var d=um_get_data_for_directory(e,"view_type");void 0===d&&(d=e.find('.um-member-directory-view-type-a[data-default="1"]').data("type")),e.data("view_type",d),e.find(".um-member-directory-view-type .um-member-directory-view-type-a").hide(),e.find('.um-member-directory-view-type .um-member-directory-view-type-a[data-type="'+d+'"]').show()}e.find(".um-datepicker-filter").each(function(){var r,t=jQuery(this),a=t.pickadate("picker"),i=um_get_data_for_directory(e,"filter_"+t.data("filter_name")+"_"+t.data("range"));void 0!==i?a.set("select",1e3*i):a.clear()}),e.find(".um-slider").each(function(){var r=jQuery(this),t=r.data("field_name"),a=um_get_data_for_directory(e,"filter_"+t+"_from"),i=um_get_data_for_directory(e,"filter_"+t+"_to");void 0===a&&(a=r.data("min")),a=parseInt(a),void 0===i&&(i=r.data("max")),i=parseInt(i),r.slider("values",[a,i]),um_set_range_label(r)}),e.find(".um-timepicker-filter").each(function(){var r,t=jQuery(this),a=t.pickatime("picker"),i=um_get_data_for_directory(e,"filter_"+t.data("filter_name")+"_"+t.data("range"));if(void 0!==i){var m=i.split(":");a.set("select",60*m[0])}else a.clear()});var s=!1;if(!(s=wp.hooks.applyFilters("um_member_directory_ignore_after_search",s,e))&&1===e.data("must-search")){var t=um_get_search(e);if(um_get_filters_data(e).length||t)e.data("searched",1);else{e.data("searched",0),um_members_hide_preloader(e);return}}wp.hooks.applyFilters("um_member_directory_prevent_default_first_loading",!1,e,r)||(um_ajax_get_members(e),um_change_tag(e))})})});
